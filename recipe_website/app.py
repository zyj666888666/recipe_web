from flask import Flask, render_template, redirect, url_for
from flask_sqlalchemy import SQLAlchemy
from pypinyin import lazy_pinyin
import string

app = Flask(__name__)
# 配置SQLite数据库
app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///recipes.db'
app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False
db = SQLAlchemy(app)

# 定义菜品数据模型
class Recipe(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(100), unique=True, nullable=False, comment="菜品名称")
    initial = db.Column(db.String(1), nullable=False, comment="拼音首字母")
    steps = db.Column(db.Text, nullable=False, comment="做菜步骤")

# 获取中文首字母（大写）
def get_initial(chinese_name):
    pinyin_list = lazy_pinyin(chinese_name[0], style=0)
    initial = pinyin_list[0][0].upper()
    # 非字母则归为#
    return initial if initial in string.ascii_uppercase else '#'

# 120道菜品数据（含素菜、荤菜、汤品、主食）
RECIPES_DATA = [
    # 素菜类（30道）
    ("番茄炒蛋", "1. 番茄洗净切块，鸡蛋打入碗中加少许盐打散\n2. 热锅倒油，油热后倒入蛋液，炒至凝固盛出备用\n3. 锅中留底油，放入番茄块翻炒至出汁\n4. 倒入炒好的鸡蛋，加适量盐和糖调味，翻炒均匀即可出锅"),
    ("青椒土豆丝", "1. 土豆去皮切丝，放入清水中浸泡去淀粉；青椒切丝\n2. 锅中烧水，水开后放入土豆丝焯烫10秒，捞出过凉沥干\n3. 热锅倒油，放蒜末爆香，倒入土豆丝和青椒丝大火翻炒\n4. 加生抽、盐调味，翻炒至断生即可装盘"),
    ("酸辣土豆丝", "1. 土豆去皮切丝，清水浸泡去淀粉；干辣椒切段、葱蒜切末\n2. 热锅倒油，放干辣椒、花椒爆香，加葱蒜炒出香味\n3. 倒入土豆丝大火翻炒，加醋、盐、糖调味，翻炒至断生撒葱花即可"),
    ("清炒西兰花", "1. 西兰花切小朵，焯水1分钟捞出过凉；胡萝卜切片\n2. 热锅倒油，放蒜末爆香，倒入西兰花和胡萝卜翻炒\n3. 加少许盐、蚝油调味，翻炒均匀后加少许水淀粉勾芡即可"),
    ("手撕包菜", "1. 包菜手撕成片，干辣椒切段、蒜切片\n2. 热锅倒油，放干辣椒、花椒、蒜片爆香\n3. 倒入包菜大火翻炒至变软，加生抽、醋、盐调味，翻炒均匀即可"),
    ("清炒油麦菜", "1. 油麦菜洗净切段，蒜切末\n2. 热锅倒油，放蒜末爆香，倒入油麦菜大火翻炒\n3. 加少许盐、蚝油调味，翻炒至菜叶变软即可出锅"),
    ("凉拌黄瓜", "1. 黄瓜拍碎切块，蒜末、小米辣切好备用\n2. 碗中加蒜末、小米辣、生抽、醋、糖、香油调汁\n3. 把料汁倒在黄瓜上，搅拌均匀后静置5分钟即可"),
    ("拍蒜炒生菜", "1. 生菜洗净沥干，蒜拍碎切末\n2. 热锅倒油，放蒜末爆香，倒入生菜大火翻炒\n3. 加少许盐调味，翻炒至生菜变软即可出锅"),
    ("清炒荷兰豆", "1. 荷兰豆去筋洗净，胡萝卜切片，蒜切末\n2. 锅中烧水，加少许盐和油，放入荷兰豆焯水30秒捞出\n3. 热锅倒油，放蒜末爆香，倒入荷兰豆和胡萝卜翻炒，加盐调味即可"),
    ("凉拌番茄", "1. 番茄洗净切块，放入盘中\n2. 撒上适量白糖，静置10分钟让番茄出汁即可食用"),
    ("炒菠菜", "1. 菠菜洗净切段，蒜切末\n2. 锅中烧水，放菠菜焯水10秒捞出沥干\n3. 热锅倒油，放蒜末爆香，倒入菠菜翻炒，加盐调味即可"),
    ("干煸四季豆", "1. 四季豆摘去老筋，洗净沥干；干辣椒切段、蒜切末\n2. 热锅倒油，放入四季豆炸至表皮微皱捞出\n3. 锅中留底油，放干辣椒、蒜末、花椒爆香，倒入四季豆翻炒，加盐、生抽调味即可"),
    ("清炒苦瓜", "1. 苦瓜去瓤切片，用盐腌制10分钟后挤干水分；蒜切末\n2. 热锅倒油，放蒜末爆香，倒入苦瓜翻炒\n3. 加少许盐、糖调味，翻炒至苦瓜变软即可"),
    ("凉拌海带丝", "1. 海带丝泡发洗净，焯水2分钟捞出过凉\n2. 碗中加蒜末、小米辣、生抽、醋、盐、香油调汁\n3. 海带丝加料汁和香菜段，搅拌均匀即可"),
    ("蒜蓉娃娃菜", "1. 娃娃菜切瓣，摆盘后撒上蒜末\n2. 淋上生抽和少许清水，上锅蒸8分钟\n3. 取出后淋上热油，撒葱花即可"),
    ("清炒藕片", "1. 莲藕切片，清水浸泡去淀粉；青椒切片、蒜切末\n2. 锅中烧水，放藕片焯水1分钟捞出\n3. 热锅倒油，放蒜末爆香，倒入藕片和青椒翻炒，加盐、醋调味即可"),
    ("凉拌木耳", "1. 木耳泡发洗净，焯水1分钟捞出过凉；黄瓜切丝\n2. 碗中加蒜末、小米辣、生抽、醋、盐、香油调汁\n3. 木耳和黄瓜丝加料汁拌匀，撒香菜即可"),
    ("炒豆芽", "1. 绿豆芽洗净沥干，干辣椒切段、蒜切末\n2. 热锅倒油，放干辣椒、蒜末爆香，倒入豆芽大火翻炒\n3. 加少许盐、醋调味，翻炒至豆芽断生即可"),
    ("清炒芦笋", "1. 芦笋切段，焯水30秒捞出；蒜切末\n2. 热锅倒油，放蒜末爆香，倒入芦笋翻炒\n3. 加少许盐、蚝油调味，翻炒均匀即可"),
    ("凉拌皮蛋", "1. 皮蛋切块摆盘，蒜末、小米辣切好备用\n2. 碗中加蒜末、小米辣、生抽、醋、香油调汁\n3. 料汁淋在皮蛋上，撒葱花即可"),
    ("蒜蓉西兰花", "1. 西兰花切小朵焯水，蒜切末\n2. 热锅倒油，放蒜末爆香，倒西兰花翻炒\n3. 加盐、蚝油调味，水淀粉勾芡即可"),
    ("红烧茄子", "1. 茄子切条，用盐腌制10分钟挤干水分；蒜切末\n2. 热锅倒油，放茄子煎至变软盛出\n3. 锅中留底油，放蒜末、豆瓣酱爆香，倒茄子翻炒，加盐、生抽调味即可"),
    ("韭菜炒豆芽", "1. 韭菜切段，豆芽洗净沥干；蒜切末\n2. 热锅倒油，放蒜末爆香，倒豆芽翻炒\n3. 加韭菜翻炒至断生，加盐调味即可"),
    ("凉拌三丝", "1. 土豆、胡萝卜、黄瓜切丝，土豆丝焯水过凉\n2. 碗中加蒜末、生抽、醋、盐、香油调汁\n3. 三丝加料汁拌匀即可"),
    ("清炒空心菜", "1. 空心菜洗净切段，蒜切末\n2. 热锅倒油，放蒜末爆香，倒空心菜翻炒\n3. 加盐、蚝油调味，翻炒至菜叶变软即可"),
    ("醋溜白菜", "1. 白菜切片，干辣椒切段、蒜切末\n2. 热锅倒油，放干辣椒、蒜末爆香，倒白菜翻炒\n3. 加醋、盐调味，翻炒至白菜变软即可"),
    ("麻辣豆腐", "1. 豆腐切块焯水，干辣椒切段、花椒备用\n2. 热锅倒油，放干辣椒、花椒爆香，加豆瓣酱炒出红油\n3. 放豆腐翻炒，加盐、生抽调味，水淀粉勾芡即可"),
    ("白灼生菜", "1. 生菜洗净，锅中烧水加少许盐和油\n2. 放入生菜焯水10秒捞出摆盘\n3. 淋上生抽，浇热油撒葱花即可"),
    ("凉拌黄瓜木耳", "1. 黄瓜拍碎，木耳焯水过凉\n2. 加蒜末、生抽、醋、盐、香油拌匀即可"),
    ("清炒豆苗", "1. 豆苗洗净，蒜切末\n2. 热锅倒油，放蒜末爆香，倒豆苗翻炒\n3. 加盐调味，翻炒至断生即可"),
    ("香煎豆腐", "1. 豆腐切片，用盐腌制5分钟\n2. 平底锅倒油，放豆腐煎至两面金黄\n3. 撒上椒盐或淋生抽即可"),

    # 荤菜类（40道）
    ("红烧肉", "1. 五花肉切块，冷水下锅焯水去血沫，捞出沥干\n2. 热锅放少许油，加冰糖炒至融化呈琥珀色\n3. 倒入肉块翻炒上色，加姜片、葱段、八角、桂皮\n4. 加没过肉的热水，放生抽、老抽，大火烧开转小火炖40分钟\n5. 大火收汁，加盐调味即可"),
    ("可乐鸡翅", "1. 鸡翅洗净，两面划刀，冷水下锅加姜片焯水去血沫\n2. 热锅倒油，放鸡翅煎至两面金黄\n3. 倒入可乐没过鸡翅，加生抽、老抽、姜片，大火烧开转小火炖20分钟\n4. 大火收汁，撒葱花即可"),
    ("青椒炒肉丝", "1. 猪肉切丝，加生抽、料酒、淀粉腌制10分钟；青椒切丝\n2. 热锅倒油，放入肉丝滑炒至变色盛出\n3. 锅中留底油，放蒜末爆香，倒入青椒丝翻炒，加肉丝炒匀，加盐调味即可"),
    ("番茄炖牛腩", "1. 牛腩切块，冷水下锅焯水去血沫；番茄切块\n2. 热锅倒油，放姜片爆香，倒入牛腩翻炒，加料酒去腥\n3. 加热水没过牛腩，大火烧开转小火炖1小时\n4. 放入番茄块，继续炖20分钟，加盐、糖调味即可"),
    ("宫保鸡丁", "1. 鸡胸肉切丁，加生抽、料酒、淀粉腌制10分钟；花生米炒熟备用\n2. 碗中加生抽、醋、糖、淀粉、清水调汁\n3. 热锅倒油，放干辣椒、花椒爆香，加鸡丁滑炒至变色\n4. 放胡萝卜丁、黄瓜丁翻炒，淋料汁勾芡，加花生米炒匀即可"),
    ("鱼香肉丝", "1. 猪肉切丝，加生抽、料酒、淀粉腌制10分钟；木耳、胡萝卜、笋切丝\n2. 碗中加生抽、醋、糖、豆瓣酱、淀粉、清水调鱼香汁\n3. 热锅倒油，放肉丝滑炒至变色盛出\n4. 锅中留底油，放豆瓣酱炒出红油，加葱姜蒜爆香，倒配菜翻炒，加肉丝和鱼香汁炒匀即可"),
    ("水煮肉片", "1. 猪肉切片，加生抽、料酒、淀粉腌制10分钟；生菜、豆芽洗净铺碗底\n2. 热锅倒油，放豆瓣酱炒出红油，加姜片、蒜片、干辣椒爆香，加清水烧开\n3. 放入肉片滑熟，连汤倒入碗中，撒花椒、辣椒面、蒜末\n4. 淋上热油激出香味即可"),
    ("回锅肉", "1. 五花肉冷水下锅，加姜片、葱段煮20分钟捞出切片；青椒切片\n2. 热锅倒油，放入肉片煸炒至出油卷曲\n3. 放豆瓣酱炒出红油，加姜片、蒜片、青椒翻炒，加生抽、糖调味即可"),
    ("糖醋排骨", "1. 排骨切块，冷水下锅焯水去血沫，捞出沥干\n2. 热锅倒油，放排骨煎至表面微黄\n3. 加姜片、料酒，倒入糖醋汁（糖:醋:生抽:水=3:2:1:4），大火烧开转小火炖30分钟\n4. 大火收汁，撒白芝麻即可"),
    ("土豆烧排骨", "1. 排骨切块焯水，土豆切块；姜蒜切片、八角备用\n2. 热锅倒油，放排骨煎至微黄，加姜蒜、八角爆香\n3. 加生抽、老抽、料酒，倒入热水没过排骨，炖20分钟\n4. 放土豆块继续炖15分钟，加盐调味，大火收汁即可"),
    ("麻婆豆腐", "1. 豆腐切块，焯水2分钟捞出；牛肉末备用\n2. 热锅倒油，放牛肉末炒至变色，加豆瓣酱炒出红油\n3. 加姜蒜末、干辣椒粉爆香，加清水烧开，放豆腐炖5分钟\n4. 加水淀粉勾芡，撒花椒粉、葱花即可"),
    ("红烧排骨", "1. 排骨切块焯水，捞出沥干；姜葱八角备用\n2. 热锅倒油，加冰糖炒出糖色，倒入排骨翻炒上色\n3. 加姜葱、八角、生抽、老抽、料酒，倒热水没过排骨\n4. 大火烧开转小火炖40分钟，加盐调味，大火收汁即可"),
    ("清炒虾仁", "1. 虾仁去线洗净，用盐、淀粉腌制5分钟；黄瓜、胡萝卜切丁\n2. 热锅倒油，放虾仁滑炒至变色盛出\n3. 锅中留底油，放配菜翻炒，加虾仁炒匀，加盐、鸡精调味即可"),
    ("黄焖鸡", "1. 鸡腿切块焯水，青椒、土豆切块；姜蒜八角备用\n2. 热锅倒油，放姜蒜、八角爆香，加鸡块翻炒至微黄\n3. 加生抽、老抽、料酒、冰糖，倒热水没过鸡块，炖20分钟\n4. 放土豆、青椒炖10分钟，加盐调味即可"),
    ("红烧鱼块", "1. 草鱼切块，用盐、料酒腌制10分钟；姜蒜切片\n2. 热锅倒油，放鱼块煎至两面金黄捞出\n3. 锅中留底油，放姜蒜、豆瓣酱爆香，加清水、生抽、老抽烧开\n4. 放入鱼块炖10分钟，大火收汁，撒葱花即可"),
    ("洋葱炒牛肉", "1. 牛肉切丝，加生抽、料酒、淀粉腌制10分钟；洋葱切丝\n2. 热锅倒油，放牛肉丝滑炒至变色盛出\n3. 锅中留底油，放洋葱丝翻炒至变软，加牛肉丝炒匀，加盐、蚝油调味即可"),
    ("蒜薹炒肉", "1. 猪肉切丝，加生抽、淀粉腌制5分钟；蒜薹切段\n2. 热锅倒油，放肉丝滑炒至变色盛出\n3. 锅中留底油，放蒜薹翻炒至断生，加肉丝炒匀，加盐、生抽调味即可"),
    ("剁椒鱼头", "1. 鱼头洗净摆盘，铺剁椒、姜片、蒜末\n2. 淋上生抽和少许料酒，上锅蒸15分钟\n3. 取出后撒葱花，淋上热油即可"),
    ("清蒸鲈鱼", "1. 鲈鱼洗净，鱼身划刀，放姜片、葱段，淋料酒\n2. 上锅蒸8分钟，取出倒掉汤汁，捡去姜葱\n3. 铺新的葱姜丝，淋生抽，浇上热油即可"),
    ("辣子鸡", "1. 鸡肉切丁，用盐、料酒、淀粉腌制10分钟；干辣椒切段\n2. 热锅倒油，放鸡丁炸至金黄捞出\n3. 锅中留底油，放干辣椒、花椒、姜蒜爆香，倒鸡丁翻炒，加盐、糖调味即可"),
    ("香菇滑鸡", "1. 鸡腿肉切块，加生抽、料酒、淀粉腌制10分钟；香菇泡发切块\n2. 热锅倒油，放鸡块滑炒至变色，加香菇翻炒\n3. 加少许清水，炖5分钟，加盐、蚝油调味即可"),
    ("红烧猪蹄", "1. 猪蹄切块焯水，捞出沥干；姜葱八角桂皮备用\n2. 热锅倒油，加冰糖炒出糖色，倒猪蹄翻炒上色\n3. 加姜葱、香料、生抽、老抽、料酒，倒热水没过猪蹄\n4. 大火烧开转小火炖1.5小时，加盐调味，大火收汁即可"),
    ("韭菜炒鸡蛋", "1. 韭菜洗净切段，鸡蛋打入碗中加少许盐打散\n2. 热锅倒油，倒入蛋液炒至凝固盛出备用\n3. 锅中留底油，放韭菜翻炒至断生，加鸡蛋炒匀，加盐调味即可"),
    ("木耳炒肉", "1. 猪肉切丝腌制，木耳泡发切丝，青椒切丝\n2. 热锅倒油，放肉丝滑炒至变色盛出\n3. 锅中留底油，放木耳、青椒翻炒，加肉丝炒匀，加盐、生抽调味即可"),
    ("西兰花炒虾仁", "1. 虾仁腌制，西兰花焯水；蒜切末\n2. 热锅倒油，放虾仁滑炒至变色盛出\n3. 锅中留底油，放蒜末爆香，倒西兰花翻炒，加虾仁炒匀，加盐调味即可"),
    ("青椒炒鸡蛋", "1. 青椒切丝，鸡蛋打散加盐\n2. 热锅倒油，倒蛋液炒至凝固盛出\n3. 锅中留底油，放青椒翻炒至断生，加鸡蛋炒匀，加盐调味即可"),
    ("番茄牛腩", "1. 牛腩焯水，番茄炒出汁；姜葱八角备用\n2. 牛腩加清水、香料炖1小时，放入番茄继续炖20分钟\n3. 加盐、糖调味即可"),
    ("炒猪肝", "1. 猪肝切片，用盐、料酒、淀粉腌制10分钟；青椒切片\n2. 锅中烧水，放猪肝焯水10秒捞出\n3. 热锅倒油，放姜蒜爆香，倒猪肝和青椒翻炒，加盐、生抽调味即可"),
    ("孜然羊肉", "1. 羊肉切片，用盐、料酒腌制5分钟；洋葱切丝\n2. 热锅倒油，放羊肉翻炒至变色，加洋葱丝\n3. 撒孜然粉、辣椒粉，加盐调味即可"),
    ("青椒炒腊肠", "1. 腊肠切片蒸熟，青椒切丝；蒜切末\n2. 热锅倒油，放蒜末爆香，倒青椒翻炒至断生\n3. 加腊肠炒匀，加少许生抽调味即可"),
    ("虾仁滑蛋", "1. 虾仁腌制，鸡蛋打散加少许牛奶\n2. 热锅倒油，放虾仁滑炒至变色盛出\n3. 倒蛋液炒至半凝固，加虾仁炒匀即可"),
    ("红烧鸡腿", "1. 鸡腿焯水，姜葱八角备用\n2. 冰糖炒糖色，倒鸡腿翻炒上色，加香料和调料\n3. 倒热水炖20分钟，收汁加盐即可"),
    ("白菜炒肉片", "1. 猪肉切片腌制，白菜切片；蒜切末\n2. 热锅倒油，放肉片滑炒至变色盛出\n3. 锅中留底油，放白菜翻炒至变软，加肉片炒匀，加盐调味即可"),
    ("豆角炒肉", "1. 猪肉切丝腌制，豆角切段；蒜切末\n2. 热锅倒油，放肉丝滑炒至变色盛出\n3. 锅中留底油，放豆角翻炒至断生，加肉丝炒匀，加盐、生抽调味即可"),
    ("香菇炒肉", "1. 猪肉切丝腌制，香菇切片；蒜切末\n2. 热锅倒油，放肉丝滑炒至变色盛出\n3. 锅中留底油，放香菇翻炒至出水，加肉丝炒匀，加盐、蚝油调味即可"),
    ("榨菜肉丝", "1. 猪肉切丝腌制，榨菜切丝；姜蒜切末\n2. 热锅倒油，放肉丝滑炒至变色盛出\n3. 锅中留底油，放姜蒜爆香，倒榨菜翻炒，加肉丝炒匀即可"),
    ("青椒土豆烧肉", "1. 猪肉切块焯水，土豆、青椒切块；姜蒜八角备用\n2. 猪肉炒糖色，加香料翻炒，倒热水炖20分钟\n3. 放土豆炖10分钟，加青椒炖5分钟，加盐调味即可"),
    ("清蒸虾", "1. 虾剪去须脚，开背去线；姜片铺盘\n2. 虾摆入盘中，上锅蒸5分钟\n3. 淋生抽，撒葱花，浇热油即可"),
    ("炒鱿鱼", "1. 鱿鱼切花刀焯水，青椒、洋葱切块；姜蒜切末\n2. 热锅倒油，放姜蒜爆香，倒鱿鱼翻炒\n3. 加配菜炒匀，加盐、生抽、蚝油调味即可"),
    ("水煮鱼", "1. 草鱼片用盐、料酒、淀粉腌制10分钟；豆芽焯水铺碗底\n2. 热锅倒油，放豆瓣酱、姜蒜爆香，加清水、生抽烧开\n3. 放入鱼片滑熟，连汤倒入碗中，撒花椒、辣椒面，淋热油即可"),
    ("啤酒鸭", "1. 鸭肉切块焯水，姜蒜八角备用\n2. 热锅倒油，放鸭肉翻炒至出油，加姜蒜、香料爆香\n3. 倒入啤酒没过鸭肉，大火烧开转小火炖40分钟，加盐调味即可"),

    # 汤品类（30道）
    ("番茄鸡蛋汤", "1. 番茄切块，鸡蛋打散；葱切花\n2. 热锅倒油，放番茄翻炒至出汁，加清水烧开\n3. 淋入蛋液搅出蛋花，加盐、鸡精调味，撒葱花即可"),
    ("紫菜蛋花汤", "1. 紫菜泡发洗净，鸡蛋打散；葱切花\n2. 锅中加清水烧开，放紫菜煮2分钟\n3. 淋入蛋液搅出蛋花，加盐、香油调味，撒葱花即可"),
    ("丝瓜鸡蛋汤", "1. 丝瓜去皮切块，鸡蛋打散；蒜切末\n2. 热锅倒油，放蒜末爆香，加丝瓜翻炒至变软\n3. 加清水烧开，淋蛋液煮出蛋花，加盐调味即可"),
    ("冬瓜海带排骨汤", "1. 排骨焯水，冬瓜切块，海带泡发切段；姜葱备用\n2. 排骨加清水、姜片炖1小时，放入冬瓜、海带炖20分钟\n3. 加盐、葱花调味即可"),
    ("玉米排骨汤", "1. 排骨焯水，玉米切段，胡萝卜切块；姜片备用\n2. 排骨加清水、姜片炖1小时，放入玉米、胡萝卜炖30分钟\n3. 加盐、葱花调味即可"),
    ("香菇鸡汤", "1. 鸡肉焯水，香菇泡发；姜葱备用\n2. 鸡肉加清水、姜片、香菇炖1小时\n3. 加盐、葱花调味即可"),
    ("菠菜鸡蛋汤", "1. 菠菜洗净切段，鸡蛋打散；葱切花\n2. 锅中加清水烧开，放菠菜煮1分钟\n3. 淋蛋液煮出蛋花，加盐、香油调味，撒葱花即可"),
    ("豆腐汤", "1. 豆腐切块焯水，青菜洗净；蒜切末\n2. 热锅倒油，放蒜末爆香，加清水烧开\n3. 放豆腐煮5分钟，加青菜煮软，加盐、鸡精调味即可"),
    ("番茄牛腩汤", "1. 牛腩焯水，番茄炒出汁；姜葱八角备用\n2. 牛腩加清水、香料炖1小时，放入番茄炖20分钟\n3. 加盐、糖调味即可"),
    ("萝卜排骨汤", "1. 排骨焯水，白萝卜切块；姜片备用\n2. 排骨加清水、姜片炖1小时，放入萝卜炖30分钟\n3. 加盐、葱花调味即可"),
    ("菌菇汤", "1. 各种菌菇洗净，青菜切段；蒜切末\n2. 热锅倒油，放蒜末爆香，加菌菇翻炒至变软\n3. 加清水烧开，放青菜煮软，加盐、鸡精调味即可"),
    ("鸡蛋羹", "1. 鸡蛋打入碗中，加1.5倍温水、少许盐搅匀\n2. 撇去浮沫，盖上保鲜膜，上锅蒸8分钟\n3. 淋生抽、香油，撒葱花即可"),
    ("冬瓜丸子汤", "1. 猪肉末加葱姜末、盐、淀粉搅匀，挤成丸子；冬瓜切块\n2. 锅中加清水烧开，放入丸子煮至浮起\n3. 放冬瓜煮软，加盐、葱花调味即可"),
    ("酸辣汤", "1. 豆腐、木耳、胡萝卜切丝，鸡蛋打散；姜蒜切末\n2. 热锅倒油，放姜蒜爆香，加清水烧开，放配菜煮2分钟\n3. 淋蛋液，加醋、胡椒粉、盐调味，水淀粉勾芡即可"),
    ("鲫鱼豆腐汤", "1. 鲫鱼煎至两面金黄，豆腐切块；姜片备用\n2. 加开水没过鱼，放姜片、豆腐炖20分钟\n3. 加盐、葱花调味即可"),
    ("山药排骨汤", "1. 排骨焯水，山药去皮切块；姜片备用\n2. 排骨加清水、姜片炖1小时，放入山药炖20分钟\n3. 加盐、葱花调味即可"),
    ("白菜豆腐汤", "1. 白菜切片，豆腐切块；蒜切末\n2. 热锅倒油，放蒜末爆香，加白菜翻炒至变软\n3. 加清水烧开，放豆腐煮5分钟，加盐调味即可"),
    ("皮蛋瘦肉粥", "1. 大米淘洗干净，提前浸泡30分钟；猪肉切丝腌制，皮蛋切块\n2. 大米加清水煮成粥，放入肉丝煮至变色\n3. 加皮蛋煮5分钟，加盐、葱花、香油调味即可"),
    ("小米粥", "1. 小米淘洗干净，提前浸泡20分钟\n2. 小米加清水，大火烧开转小火煮20分钟\n3. 加少许糖或盐调味即可"),
    ("银耳莲子汤", "1. 银耳泡发撕小朵，莲子去芯洗净\n2. 银耳、莲子加清水炖1小时，加冰糖煮至融化即可"),
    ("雪梨银耳汤", "1. 雪梨切块，银耳泡发撕小朵，枸杞洗净\n2. 银耳加清水炖30分钟，放雪梨、枸杞炖20分钟\n3. 加冰糖煮至融化即可"),
    ("排骨藕汤", "1. 排骨焯水，莲藕切块；姜片备用\n2. 排骨加清水、姜片炖1小时，放莲藕炖30分钟\n3. 加盐、葱花调味即可"),
    ("鸡汤", "1. 鸡切块焯水，姜葱八角备用\n2. 鸡块加清水、香料炖1.5小时\n3. 加盐、葱花调味即可"),
    ("南瓜粥", "1. 大米淘洗，南瓜切块\n2. 大米加清水煮至开花，放南瓜炖20分钟\n3. 压碎南瓜，加盐或糖调味即可"),
    ("绿豆汤", "1. 绿豆淘洗，提前浸泡2小时\n2. 绿豆加清水，大火烧开转小火煮30分钟\n3. 加冰糖煮至融化即可"),
    ("红豆薏米汤", "1. 红豆、薏米淘洗，提前浸泡2小时\n2. 加清水煮40分钟，加冰糖调味即可"),
    ("芋头排骨汤", "1. 排骨焯水，芋头切块；姜片备用\n2. 排骨炖1小时，放芋头炖20分钟，加盐调味即可"),
    ("蛤蜊豆腐汤", "1. 蛤蜊吐沙洗净，豆腐切块；姜切末\n2. 热锅倒油，放姜末爆香，加清水烧开，放蛤蜊煮至开口\n3. 放豆腐煮5分钟，加盐、葱花调味即可"),
    ("萝卜丸子汤", "1. 萝卜切块，猪肉末挤成丸子\n2. 萝卜加清水烧开，放丸子煮至浮起，加盐调味即可"),
    ("酸菜粉丝汤", "1. 酸菜切丝，粉丝泡发；姜蒜末备用\n2. 热锅倒油，放姜蒜末爆香，加酸菜翻炒\n3. 加清水烧开，放粉丝煮5分钟，加盐调味即可"),

    # 主食类（20道）
    ("蛋炒饭", "1. 米饭提前煮好放凉，鸡蛋打散，火腿、胡萝卜切丁\n2. 热锅倒油，倒蛋液炒至凝固，加配菜翻炒\n3. 倒入米饭翻炒均匀，加盐、生抽调味即可"),
    ("番茄鸡蛋面", "1. 番茄炒出汁，加清水烧开，加盐调味成汤\n2. 另起锅煮面条至熟，捞出放入汤中\n3. 打入蛋花，撒葱花即可"),
    ("葱油面", "1. 面条煮至熟，捞出放入碗中，撒葱花、盐、生抽\n2. 热锅倒油烧至冒烟，淋在葱花上激出香味\n3. 搅拌均匀即可"),
    ("饺子", "1. 肉馅加葱姜末、盐、生抽、香油搅匀，包入饺子皮\n2. 锅中加清水烧开，放入饺子煮至浮起，再加半碗水烧开\n3. 重复两次，饺子熟透即可捞出"),
    ("馄饨", "1. 肉馅加调料搅匀，包入馄饨皮\n2. 锅中加清水烧开，放馄饨煮至浮起\n3. 碗中加鸡汤/骨汤，放入馄饨，撒葱花即可"),
    ("手抓饼", "1. 手抓饼胚放入平底锅，小火煎至两面金黄\n2. 打入鸡蛋摊匀，加生菜、火腿、酱料卷起来即可"),
    ("炒面", "1. 面条煮至八成熟，捞出过凉；青菜、火腿切丝\n2. 热锅倒油，放配菜翻炒，倒入面条\n3. 加生抽、盐、蚝油调味，翻炒均匀即可"),
    ("煮汤圆", "1. 锅中加清水烧开，放入汤圆\n2. 小火煮至汤圆浮起，再加少许冷水烧开\n3. 汤圆变大变软即可捞出"),
    ("南瓜饼", "1. 南瓜蒸熟压成泥，加糯米粉、糖揉成面团\n2. 分成小剂子，压成饼状\n3. 平底锅倒油，煎至两面金黄即可"),
    ("葱油饼", "1. 面粉加温水揉成面团，醒发20分钟\n2. 面团擀成饼，撒盐、葱花、油，卷起来再擀成饼\n3. 平底锅倒油，煎至两面金黄即可"),
    ("炸酱面", "1. 五花肉丁加豆瓣酱炒出红油，加清水炖5分钟成炸酱\n2. 面条煮至熟，捞出放入碗中\n3. 浇上炸酱，加黄瓜丝拌匀即可"),
    ("螺蛳粉", "1. 螺蛳粉用冷水泡软，锅中加清水烧开煮粉至熟\n2. 另起锅煮螺蛳粉汤包，放入腐竹、花生、酸笋\n3. 把汤和配菜倒在粉上即可"),
    ("过桥米线", "1. 米线泡发，配菜（肉片、菌菇、青菜）准备好\n2. 鸡汤/骨汤烧开，先放肉片烫熟，再加配菜\n3. 放入米线煮软，加盐调味即可"),
    ("蒸包子", "1. 面团发酵至两倍大，分成小剂子擀成皮，包入馅料\n2. 包子醒发15分钟，上锅蒸15分钟\n3. 关火焖5分钟再开盖即可"),
    ("炒年糕", "1. 年糕焯水，青菜、火腿切丝；蒜切末\n2. 热锅倒油，放蒜末爆香，加配菜翻炒\n3. 倒入年糕，加生抽、糖调味，翻炒均匀即可"),
    ("麻薯", "1. 糯米粉加温水揉成面团，分成小剂子搓圆\n2. 锅中加清水烧开，放入麻薯煮至浮起\n3. 捞出裹上熟糯米粉或椰蓉即可"),
    ("凉面", "1. 面条煮至熟，捞出过凉，加少许油拌匀\n2. 碗中加麻酱、生抽、醋、蒜水调汁\n3. 料汁淋在凉面上，加黄瓜丝、豆芽拌匀即可"),
    ("蛋包饭", "1. 做好蛋炒饭备用，鸡蛋打散煎成薄蛋皮\n2. 把蛋炒饭放在蛋皮中间，对折包起来\n3. 淋上番茄酱即可"),
    ("油条", "1. 面粉加盐、碱、温水揉成面团，醒发1小时\n2. 面团擀成饼，切条后两条叠在一起，压一下\n3. 油温六成热，放入油条胚炸至金黄膨松即可"),
    ("豆浆", "1. 黄豆提前泡发，放入破壁机，加清水\n2. 选择豆浆模式打成豆浆，过滤掉豆渣\n3. 加冰糖煮至融化即可")
]

# 初始化数据库并添加菜品
with app.app_context():
    db.create_all()
    # 清空旧数据（避免重复）
    Recipe.query.delete()
    # 批量添加菜品并自动生成首字母
    for name, steps in RECIPES_DATA:
        initial = get_initial(name)
        recipe = Recipe(name=name, initial=initial, steps=steps)
        db.session.add(recipe)
    db.session.commit()
    print("120道菜品已成功导入数据库！")

# 首页路由：按首字母展示菜品
@app.route('/')
def index():
    # 获取所有首字母并排序（A-Z + #）
    initials = sorted(set([recipe.initial for recipe in Recipe.query.all()]))
    # 按首字母分组菜品
    recipe_groups = {}
    for initial in initials:
        recipes = Recipe.query.filter_by(initial=initial).order_by(Recipe.name).all()
        recipe_groups[initial] = recipes
    return render_template('index.html', initials=initials, recipe_groups=recipe_groups)

# 菜品详情路由
@app.route('/recipe/<int:recipe_id>')
def recipe_detail(recipe_id):
    recipe = Recipe.query.get_or_404(recipe_id)
    # 把步骤按换行分割成列表，方便前端展示
    steps = recipe.steps.split('\n')
    return render_template('detail.html', recipe=recipe, steps=steps)

if __name__ == '__main__':
    # 强制重新初始化数据库和菜品数据
    with app.app_context():
        db.drop_all()  # 删除旧的数据库表
        db.create_all()  # 重新创建数据库表
        # 清空旧数据并重新导入120道菜品
        Recipe.query.delete()
        for name, steps in RECIPES_DATA:
            initial = get_initial(name)
            recipe = Recipe(name=name, initial=initial, steps=steps)
            db.session.add(recipe)
        db.session.commit()
        print("120道菜品已强制重新导入数据库！")
    # 启动网站
    app.run(debug=True, host='0.0.0.0', port=5000)